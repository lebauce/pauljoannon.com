<!doctype html>
<html>
    <head>
        <title>PLZ - Du F# dans Godot Engine</title>

        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

<link rel="shortcut icon" href="../../../content/favicon.ico?v4">
<link rel="canonical" href="http://pauljoannon.com/">

<meta property="og:title" content="Du F# dans Godot Engine">
<meta property="og:site_name" content="PLZ">
<meta property="og:image" content="https://paulloz.github.io/pauljoannon.com/content/social.jpg">
<meta property="og:url" content="http://pauljoannon.com/blog/2018/03/fsharp-dans-godot.html">
<meta property="og:locale:alternate" content="fr_FR" />


<meta name="description" content="Depuis la sortie de sa version 3, le moteur de jeu Godot permet d'écrire ses scripts en C#. Mais ce qu'on veut vraiment c'est écrire du F#.">
<meta property="og:description" content="Depuis la sortie de sa version 3, le moteur de jeu Godot permet d'écrire ses scripts en C#. Mais ce qu'on veut vraiment c'est écrire du F#.">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

<link rel="stylesheet" href="../../../css/main.css">

<script src="../../../js/script.js" type="text/javascript"></script>

        <script type="text/javascript" src="../../../js/blog.js"></script>
<script type="text/javascript" src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>

        <script type="text/javascript" src="../../../js/blog-entry.js"></script>
    </head>
    <body>
        <div class="left">
            <a class="left__toggle">
    <span class="fa-stack fa-lg">
        <i class="fa fa-info fa-stack-1x"></i>
    </span>
</a>

            <object data="../../../content/mustache.svg" type="image/svg+xml"></object>
<h1><a href="../../../blog">PLZ</a></h1>

            <div class="left--below-title">
                <p style="margin-top:0;">
    Le blog de <a href="../../../">Paulloz</a>, en bordel constant, en travaux perpétuels, corps et âme sous <a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">cc by-nc-nd</a>.
</p>
<p class="left__categories">
    <span class="left__categories__list">
        <a href="../../../blog/tags/D3.js.html">D3.js (1)</a>, <a href="../../../blog/tags/cin%C3%A9ma.html">cinéma (3)</a>, <a href="../../../blog/tags/donn%C3%A9es%20personnelles.html">données personnelles (5)</a>, <a href="../../../blog/tags/gamedev.html">gamedev (5)</a>, <a href="../../../blog/tags/humeur.html">humeur (6)</a>, <a href="../../../blog/tags/javascript.html">javascript (1)</a>, <a href="../../../blog/tags/jeu%20vid%C3%A9o.html">jeu vidéo (8)</a>, <a href="../../../blog/tags/post-mortem.html">post-mortem (4)</a>, <a href="../../../blog/tags/programmation.html">programmation (2)</a>, <a href="../../../blog/tags/rapport%20d%27auto-psy.html">rapport d'auto-psy (3)</a>, <a href="../../../blog/tags/r%C3%A9alit%C3%A9%20augment%C3%A9e.html">réalité augmentée (1)</a>, <a href="../../../blog/tags/voyage.html">voyage (1)</a>
    </span>
</p>
<p class="left__archives">
    <span class="left__archives__list">
        <a href="../../../blog/2018/08.html">2018-08 (1)</a>, <a href="../../../blog/2018/03.html">2018-03 (1)</a>, <a href="../../../blog/2018/01.html">2018-01 (1)</a>, <a href="../../../blog/2017/12.html">2017-12 (2)</a>, <a href="../../../blog/2017/08.html">2017-08 (1)</a>, <a href="../../../blog/2017/04.html">2017-04 (1)</a>, <a href="../../../blog/2017/02.html">2017-02 (2)</a>, <a href="../../../blog/2017/01.html">2017-01 (2)</a>, <a href="../../../blog/2016/11.html">2016-11 (1)</a>, <a href="../../../blog/2016/07.html">2016-07 (1)</a>, <a href="../../../blog/2016/06.html">2016-06 (1)</a>, <a href="../../../blog/2016/04.html">2016-04 (2)</a>, <a href="../../../blog/2016/02.html">2016-02 (1)</a>, <a href="../../../blog/2016/01.html">2016-01 (2)</a>, <a href="../../../blog/2015/12.html">2015-12 (3)</a>, <a href="../../../blog/2015/11.html">2015-11 (3)</a>, <a href="../../../blog/2015/10.html">2015-10 (1)</a>, <a href="../../../blog/2015/01.html">2015-01 (1)</a>, <a href="../../../blog/2013/04.html">2013-04 (1)</a>
    </span>
</p>

                <div class="separator"></div>
<p>
    <a href="mailto:hello@pauljoannon.com">hello[at]pauljoannon[dot]com</a>
    <br>
    <i class="fa fa-lock"></i>&nbsp;0x128B663C
<p>
    <a title="PLZ" class="social" target="_blank" href="../../../blog"><i class="fa fa-lg fa-pencil-square"></i></a>
    <a title="@pauljoannon sur Twitter" class="social" target="_blank" href="https://twitter.com/pauljoannon"><i class="fa fa-lg fa-twitter-square"></i></a>
    <a title="Paulloz sur GitHub" class="social" target="_blank" href="https://github.com/paulloz"><i class="fa fa-lg fa-github-square"></i></a>
    <a title="paulloz sur Reddit" class="social" target="_blank" href="https://reddit.com/user/paulloz"><i class="fa fa-lg fa-reddit-square"></i></a>
    <a title="Paulloz sur Flickr" class="social" target="_blank" href="https://flickr.com/photos/paulloz"><i class="fa fa-lg fa-flickr"></i></a>
    <a title="Paulloz sur Steam" class="social" target="_blank" href="https://steamcommunity.com/id/paulloz"><i class="fa fa-lg fa-steam-square"></i></a>
</p>

            </div>
        </div>

        <div class="right">
            <div class="blog">
                <article id="entry" class="blog__entry">
                    <h2>Du F# dans Godot Engine</h2>
                    
                    <span class="blog__entry__metadata small">
                        <i class="fa fa-calendar"></i>&nbsp;<span class="date">2018-03-24</span>
                        &nbsp;
                        <i class="fa fa-tag"></i>&nbsp;<a href="../../../blog/tags/gamedev.html">gamedev</a>, <a href="../../../blog/tags/programmation.html">programmation</a>
                    </span>
                    <div role="main">
                        <p>Depuis la sortie de sa version 3, le moteur de jeu <a href="https://www.godotengine.org/">Godot</a> permet d’écrire ses scripts en C# grâce à Mono. Aussi cool que ça puisse être, ce que le peuple veut vraiment c’est écrire tout ça en F#. Et bien avec un tout petit peu de bidouille, c’est complètement possible.<br />
Voilà comment je m’y prend.</p>
<!--more-->
<p>Première étape, créer un projet dans Godot et y créer un nœud (ici <code>TestLabel</code>) auquel est attaché un script C#.<br />
En créant ce script, les fichiers de projet C# seront créés (en l’occurrence <code>Foo.csproj</code> et <code>Foo.sln</code>).</p>
<div class="figure">
<img src="../../../content/blog/2018/03/godot-1.jpg" />

</div>
<p>Le script en question est le plus simple possible :</p>
<div class="sourceCode"><pre class="sourceCode c#"><code class="sourceCode cs"><span class="kw">using</span> Godot;

<span class="kw">public</span> <span class="kw">class</span> TestLabel : Label
{
}</code></pre></div>
<p>Deuxième étape, créer un projet F#.<br />
En ouvrant <code>Foo.sln</code> dans un IDE ça ne devrait pas poser trop de problème. Deux choses importantes : le projet doit être de type <code>Library</code> et le framework cible doit être <code>.NET Framework 4.5</code> (le même framework cible que le projet C# en fait).<br />
Il faut ensuite y ajouter une référence vers <code>GodotSharp.dll</code> qui se trouve dans le dossier du projet Godot sous <code>.mono/assemblies/</code>.<br />
En résumé, le fichier <code>.fsproj</code> devrait ressembler à ça :</p>
<div class="sourceCode"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;utf-8&quot;<span class="kw">?&gt;</span>
<span class="kw">&lt;Project</span><span class="ot"> ToolsVersion=</span><span class="st">&quot;4.0&quot;</span><span class="ot"> DefaultTargets=</span><span class="st">&quot;Build&quot;</span><span class="ot"> xmlns=</span><span class="st">&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;PropertyGroup&gt;</span>
    <span class="kw">&lt;OutputType&gt;</span>Library<span class="kw">&lt;/OutputType&gt;</span>
    <span class="kw">&lt;OutputPath&gt;</span>.mono/temp/bin/$(Configuration)<span class="kw">&lt;/OutputPath&gt;</span>
    <span class="kw">&lt;RootNamespace&gt;</span>Foo.FSharp<span class="kw">&lt;/RootNamespace&gt;</span>
    <span class="kw">&lt;AssemblyName&gt;</span>Foo.FSharp<span class="kw">&lt;/AssemblyName&gt;</span>
    <span class="kw">&lt;TargetFrameworkVersion&gt;</span>v4.5<span class="kw">&lt;/TargetFrameworkVersion&gt;</span>
    <span class="kw">&lt;BaseIntermediateOutputPath&gt;</span>.mono/temp/obj<span class="kw">&lt;/BaseIntermediateOutputPath&gt;</span>
    <span class="kw">&lt;IntermediateOutputPath&gt;</span>$(BaseIntermediateOutputPath)/$(Configuration)<span class="kw">&lt;/IntermediateOutputPath&gt;</span>
  <span class="kw">&lt;/PropertyGroup&gt;</span>
  <span class="kw">&lt;ItemGroup&gt;</span>
    <span class="kw">&lt;Compile</span><span class="ot"> Include=</span><span class="st">&quot;TestLabel.fs&quot;</span> <span class="kw">/&gt;</span>
  <span class="kw">&lt;/ItemGroup&gt;</span>
  <span class="kw">&lt;ItemGroup&gt;</span>
    <span class="kw">&lt;Reference</span><span class="ot"> Include=</span><span class="st">&quot;GodotSharp&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;HintPath&gt;</span>$(ProjectDir)/.mono/assemblies/GodotSharp.dll<span class="kw">&lt;/HintPath&gt;</span>
      <span class="kw">&lt;Private&gt;</span>False<span class="kw">&lt;/Private&gt;</span>
    <span class="kw">&lt;/Reference&gt;</span>
    <span class="kw">&lt;Reference</span><span class="ot"> Include=</span><span class="st">&quot;GodotSharpEditor&quot;</span><span class="ot"> Condition=</span><span class="st">&quot; '$(Configuration)' == 'Tools' &quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;HintPath&gt;</span>$(ProjectDir)/.mono/assemblies/GodotSharpEditor.dll<span class="kw">&lt;/HintPath&gt;</span>
      <span class="kw">&lt;Private&gt;</span>False<span class="kw">&lt;/Private&gt;</span>
    <span class="kw">&lt;/Reference&gt;</span>
  <span class="kw">&lt;/ItemGroup&gt;</span>
  <span class="kw">&lt;Import</span><span class="ot"> Project=</span><span class="st">&quot;$(MSBuildBinPath)\..\..\..\Microsoft F#\v4.0\Microsoft.FSharp.Targets&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/Project&gt;</span></code></pre></div>
<p>Troisième étape, le projet C# d’origine doit avoir connaissance du nouveau projet F#. Je le référence donc dans <code>Foo.csproj</code>.</p>
<div class="sourceCode"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;utf-8&quot;<span class="kw">?&gt;</span>
<span class="kw">&lt;Project</span><span class="ot"> ToolsVersion=</span><span class="st">&quot;4.0&quot;</span><span class="ot"> DefaultTargets=</span><span class="st">&quot;Build&quot;</span><span class="ot"> xmlns=</span><span class="st">&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;</span><span class="kw">&gt;</span>
    ...
    <span class="kw">&lt;ItemGroup&gt;</span>
      <span class="kw">&lt;ProjectReference</span><span class="ot"> Include=</span><span class="st">&quot;Foo.fsproj&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;/ItemGroup&gt;</span>
    ...
<span class="kw">&lt;/Project&gt;</span></code></pre></div>
<p>À partir de maintenant, chaque compilation du projet Godot entraînera aussi une compilation du projet F#. C’est presque bon !</p>
<p>La dernière étape c’est écrire mon code F#.</p>
<div class="sourceCode"><pre class="sourceCode fsharp"><code class="sourceCode fsharp"><span class="kw">namespace</span> Foo<span class="kw">.</span>FSharp
<span class="ot">#light</span>

<span class="ot">open</span> Godot

<span class="kw">type</span> TestLabel() =
    <span class="kw">inherit</span> Label()

    <span class="kw">override</span> this._Ready() =
        <span class="kw">do</span> GD<span class="kw">.</span>Print <span class="st">&quot;Cool, du F# !&quot;</span></code></pre></div>
<p>Et faire en sorte que le script que j’ai assigné précédemment à mon nœud hérite de mon type F#.</p>
<div class="sourceCode"><pre class="sourceCode c#"><code class="sourceCode cs"><span class="kw">using</span> Godot;

<span class="kw">public</span> <span class="kw">class</span> TestLabel : Foo.<span class="fu">FSharp</span>.<span class="fu">TestLabel</span>
{
}</code></pre></div>
<p>Rien besoin de plus, tout fonctionne au top et la douceur du F# s’offre à moi !</p>
<div class="figure">
<img src="../../../content/blog/2018/03/godot-2.jpg" />

</div>
                    </div>
                    <p class="blog__entry__link small align-right">
                        <span>
                            <a href="javascript:window.history.back()"><i class="fa fa-angle-left"></i>&nbsp;Retour</a>
                        </span>
                        &nbsp;
                        <span>
                            <a href="#entry"><i class="fa fa-angle-up"></i>&nbsp;Remonter</a>
                        </span>
                        &nbsp;
                        <span>
                            <a class="tweet"><i class="fa fa-twitter"></i>&nbsp;Tweeter</a>
                        </span>
                    </p>
                    <div class="separator"></div>
                    <div class="blog__entry__footer">
                        <p>
                            Non, non, il n'y a pas de commentaires sur ce blog.
                            <br>
                            Pour toute réaction, insulte ou mot d'amour, les liens pour me contacter sont un peu plus haut sur la gauche. ❤️
                        </p>
                    </div>
                </article>
            </div>
        </div>

        <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.paulloz.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.paulloz.com/piwik.php?idsite=1" style="border:0;" alt /></p></noscript>
<!-- End Piwik Code -->

    </body>
</html>
